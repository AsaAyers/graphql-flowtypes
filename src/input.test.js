// @flow
/* eslint-env jest */
import template from '@babel/template'
import { transform } from '.'
import traverse from '@babel/traverse'

export const parserConfig = {
  plugins: [
    'jsx',
    'flow',
    'doExpressions',
    'objectRestSpread',
    'decorators',
    'classProperties',
    'exportExtensions',
    'asyncGenerators',
    'functionBind',
    'functionSent',
    'dynamicImport'
  ]
}

const stripLocation = (ast) => {
  traverse(ast, {
    enter (path) {
      delete path.node.start
      delete path.node.end
      delete path.node.loc
    }
  })
  // I don't know why traverse doesn't visit the root node
  delete ast.start
  delete ast.end
  delete ast.loc
  return ast
}

// Copied from Github's schema
test('will convert an input containing only primatives', async () => {
  const actual = transform(`
  # Autogenerated input type of AcceptTopicSuggestion
  input AcceptTopicSuggestionInput {
    # A unique identifier for the client performing the mutation.
    clientMutationId: String

    # The name of the suggested topic.
    name: String!

    # The Node ID of the repository.
    repositoryId: ID!
  }
  `)

  const expected = stripLocation(template.program(`
  type AcceptTopicSuggestionInput = {|
    clientMutationId?: ?string,
    name: string,
    repositoryId: string,
  |}`, parserConfig)({}))

  expect(actual).toEqual(expected)
})
